\documentclass[12pt]{article}

\usepackage{float, graphicx}
\usepackage[margin=2.5cm]{geometry}
\usepackage{amsmath, amsthm, amssymb}
\usepackage{wrapfig}
\usepackage[lined,boxed,commentsnumbered]{ algorithm2e }
\graphicspath{ { ./img/ } }
\newtheorem{definition}{Definition}

\begin{document}

\begin{titlepage}
	\begin{center}
		~\\[2.5cm]
		{\Huge Simulating Detachment of Tumor Cell Clusters}\\[1.5cm]
		{\Large HGEN 396: Human Genetics Research Project}\\[7.5cm]
		\emph{Student:}\\
		Mr. Zafarali Ahmed (260560472)\\[1.0cm]
		\emph{Supervisor:}\\
		Dr. Simon Gravel\\[1.0cm]
		\emph{Submission Date:}\\
		\today\\
		\emph{McGill University}
	\end{center}
\end{titlepage}

\begin{abstract}
Using an implementation of the Cellular Potts Model, we attempt to simulate the detachment of a tumor cell from a tumor. Blood of patients with cancer contain Circulating Tumor Cells (CTCs) and recent advances in capture technology find that CTCs exist in single cells as well as clusters \cite{Aceto2014}. Studies have hypothesized their relative contributions to metastasis, including the controversial role of plakoglobin. 
\end{abstract}

\section{Introduction}
Cancer is the autonomous and uncontrolled growth of cells that forms a feed forward system to reinforce the tumorsâ€™ existence \cite{hallmarks}. However, for cancerous cells to keep growing and overcome the limitations of diffusion of nutrients, tumors have two solutions: angiogenesis and metastasis. While angiogenesis permits tumors to grow blood vessels to bring in nutrients, metastasis is the migration of cancer cells to other parts of the body often via the blood vessels. It is often after metastasis that cancer becomes difficult to contain and treat despite surgical resection \cite{Hatzikirou2012}.

For the tumor cells to perform invasion, the first step in metastasis, the migrating cell must alter cell surface interaction with its microenvironment: neighboring cells and the extra cellular matrix. Altered expression of cell adhesion molecules like cadherins, catenins and plakgoblin facilitate these changes in interactions \cite{Aktary2012}. Once in the blood stream, they are referred to as Circulating Tumor Cells (CTCs).

In a recent study \cite{Aceto2014}, CTC-Chip and CTC-iChip isolation of blood from patients with breast cancer verified the existence of both Single-CTCs and CTC-Clusters. Despite being rare, these clusters demonstrated (i) higher metastatic potential, (ii) faster disease progression and were found to (iii) originate directly from the tumor rather than aggregate in the blood.

Capturing the above tumor dynamics, we attempt to use the Cellular Potts Model to simulate and investigate parameters resulting in the formation of single-CTCs and CTC-clusters.

\section{Purpose and Objectives}
It is necessary to build intuition of the factors that lead to the production of single-CTCs versus CTC-clusters and the sizes of CTC-clusters produced. Since CTC-clusters have elevated metastatic potential and lethality, understanding how they detach from the parent tumors can lead to possible therapeutic strategies.

Our objective with this paper is to build a toy model that can easily be extended to account for the formation for single-CTCs and CTC-clusters.

\section{Materials and Methods}
\subsection{Cellular Potts Model (CPM)}
The Cellular Potts Model \cite{Graner1992} is a simple, yet powerful, model was used to simulate tissue cultures.  The model is an extension of the q-Potts Model in statistical mechanics. It consists of a $M\times M$ lattice of \emph{spins}. For a more biological interpretation, we can consider a \emph{spin} to represent an area of \emph{cell cytoplasm}. At any location of the lattice $(x,y)$, a spin can take on a value $\sigma(x,y) = \{0,1,\cdot N\}$. A \emph{cell}, $\sigma$, is defined as a colelction of these spins; as such this restricts same-spin values to be neighbours of each other. If $\sigma(x,y) = 0$, then this region is said to be the \emph{extra cellular matrix (ECM)}. To be able to simulate different \emph{types} of cells, for example proliferating and migrating cells, we introduce $\tau(\sigma)$, which returns the \emph{type} of the cell $\sigma$. Two cells can be seen in Figure \ref{basic}.
%% @TODO figures to show comparison?!?!%

For each position on the lattice, we define a \emph{Hamiltonian} $H$, as follows:
\[
	H = H_{surface} + H_{area} + H_{gradients}
\]
\begin{itemize}
	\item $H_{surface}$ characterizes the surface tension between a cell $\sigma$ and its neighbours.
	\item $H_{area}$ captures the dynamics of cells being restricted to a certain size.
	\item $H_{gradients}$ captures any external forces applied to cells due to chemical potentials and other pertubations.
\end{itemize}

The simulation then proceeds via a Monte Carlo method to flip spins in the lattice in an attempt to grow and move cells. Cells will move to minimize this Hamiltonian.

\subsection{Hamiltonian Equations}
Cells experience surface tensions when they interact with their environment, this effect is captured by the following Hamiltonian function:

\begin{equation}
	H_{surface} (x,y) = \sum_{\sigma' \in \text{neighbours}~\sigma} J(\tau(\sigma), \tau(\sigma'))(1-\delta(\sigma, \sigma'))
\end{equation}

$J(\tau_1, \tau_2)$ is the cell-interaction function that returns the surface tension between two cell types and $\delta$ is the Kronecker delta function, $\delta(x,y)=\{1:~\text{if }x=y;~0:~\text{otherwise}\}$. The Kronecker delta function prevents us from considering two lattice positions of the same spin to have a surface tension since these two spins are part of the same cell.

Cells cannot grow indefinitely. If cells are too big they cannot efficiently diffuse nutrients and shuttle machinery within its cell boundaries. This effect can be captured by the following Hamiltonian:

\begin{equation}
	H_{area} = \sum_{\text{all spins }\sigma} (a_{current}(\sigma)-a_{target})^2 \cdot \theta(a_{target}(\sigma))
\end{equation}

Here $a(\sigma)$ is the function that returns the current and target area of the cell and $\theta(x)=\{0:~\text{if}~x\leq 0; 1:~\text{if}~x>0\}$. Here $\theta(x)$ works to prevent us from considering negative target areas where we have defined $a_{target}(\sigma_{ECM}) < 0$.

Finally, we would like to add perturbations to our model. For example, we would like there to be an oxygen gradient towards a blood vessel that makes it energetically favorable for cells to move away from the main tissue. This effect can be captured with the following Hamiltonian:
\begin{equation}
	H_{gradients}(x,y) = V(x,y)
\end{equation}
Where $V(x,y)$ is some potential which we can change to simulate a variety of different effects.

\subsection{Monte Carlo Metropolis Algorithm}
Each \emph{spin copy attempt} of our simulation follows the algorithm outlined below \cite{Glazier2007}:

\begin{enumerate}
  \item Choose a lattice site at random $(x,y)$ with a spin $\sigma_{select}$
  \item Pick a trial spin $\sigma_{trial}$ from the neighbors of $(x,y)$
  \item Calculate $H_{initial}$ using $\sigma_{select}$
  \item Calculate $H_{final}$ using $\sigma_{trial}$
  \item Calcualte energy change, $\Delta H = H_{final} - H_{intial}$
  \item{ Change $\sigma_{select}$ to that of $\sigma_{trial}$ with the probability:
  \[
 		P(\text{Spin Copy Attempt Successful}) =
  	\begin{cases}
   		1 & \text{if } \Delta H \leq 0 \\
   		\exp{(-\frac{\Delta H}{T})}       & \text{if } \Delta H > 0
  	\end{cases}
	\]
}
\end{enumerate}

Here the temperature, $T$, accounts for thermal fluctuations and adds a stochastic element to our algorithm where a cell can change its shape to a unfavorable one if it obtains some energy from the environment in the formal of a thermal kick. The higher $T$ is, the more likely the unfavorable spin copy attempt is.

\begin{definition}[Monte Carlo Time Step (MCS)] One Monte Carlo Time Step is $M$ spin copy attempts, where $M$ is the size of the lattice.
\end{definition}

\subsection{Implementation and Parameters}
The model was implemented in the Python programming language and graphics were generated using Matplotlib\cite{matplotlib}. The parameters for simulations in this paper are shown in (table) or are otherwise mentioned. %@TODO% 

\subsection{Simulation and Experimental Setup}
% How were the experiments set up and methodology behind it%
\begin{definition}[$k$-CTC]
A Circulating Tumor Cell Cluster containing $k$ cells, $8>k>0$.
\end{definition}

Experiments were set up to test the feasability of the model. We would like to compare $k$-CTCs of different sizes (note that a $1$-CTC is just a single cell). To do this we run races between different $k$-CTCs and compare metrics. We also simulate forces on tissues in an attempt to produce $k$-CTCs from it.

\subsubsection{Races}
An example of a race is shown in  Figure \ref{single_race}. Races between clusters of different sizes were run for $t=8000MCS$ with a constant y-directional force. The displacement, $\Delta x$, of the clusters were calculated based on the difference between the $y$-coordinates of the leading edges of the cell before and after the race was run. This allowed us to calculate their average velocities. Velocity was converted to \emph{relative velocity} to allow easier comparison with $1$-CTCs. Heatmaps (Figure \ref{race_end}) of finishing positions are plotted to show the average ending positions of each $k$-CTC. We also calculated coefficients for cell survival, cluster split, cluster death, and cluster joining. 

Different orientations of clusters were considered in the $k=2$ case (Figure \ref{race_start}) to investigate how orientation would affect velocity and survival.


%% RESULTS

\section{Results}
The results of the races for the $k$-CTCs are shown in Table \ref{racestats} for $k=\{1,2,3,4\}$.
\subsection{}
 notice that $2$-CTCs can be oriented vertically and horizontally to observe their differences.




%% DISCUSSIONS
\section{Discussion}
\section{Conclusion}

\pagebreak
\section{Tables and Figures}

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.5]{img/basic}
	\caption{An example of two cells in a lattice, each color represents a different cell $\sigma$. The grey area is the Extra Cellular Matrix}
	\label{basic}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.40]{img/before_race_single}
	\includegraphics[scale=0.40]{img/after_race_single}
	\caption{A race between four cells: Starting positions (left) before the race is conducted and the typical positions (right) of the cells after the race concludes ($8000MCS$)}
	\label{single_race}
\end{figure}

\begin{table}[h]
    \begin{tabular}{|l|l|l|l|l|l|}
    \hline
    ~                & $1$-CTC   & $2$-CTC (vertical) & $2$-CTC (horizontal) & $3$-CTC & $4$-CTC \\ \hline
    Total Clusters   & 44      & 44           & 45          & 44 & 44  \\ \hline
    Total Cells 		 & 44			 & 88					& 90						& 132 & 176 \\ \hline
    Cell Survival    & 0.932  & 1.000        & 0.944        & 0.992 & 0.994 \\ \hline
    Cluster Spliting & N/A     & 0.068       & 0.111        & 0.045 & 0.068 \\ \hline
    Cluster Survival & 0.932$^*$ & 1.000      & 0.978       & 1.000 & 1.000 \\ \hline
    Cluster Joining  & 0.114  & 0.136        & 0.022        & 0.091 & 0.159 \\ \hline
    Relative Cluster Velocity$^{**}$ & 1.000  & 0.877       & 1.014     & 0.895  & 0.895 \\ \hline
    \end{tabular}
    \caption{Metrics for $k$-CTC races.
    \emph{* $1$-CTC cluster survival = cell survival}
    \emph{** Relative to $1$-CTC velocity}}
    \label{racestats}
\end{table}

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.20]{img/1ctc-start}
	\includegraphics[scale=0.20]{img/2vert-start}
	\includegraphics[scale=0.20]{img/2horz-start}
	\includegraphics[scale=0.20]{img/3ctc-start}
	\includegraphics[scale=0.20]{img/4ctc-start}
	\caption{Starting positions of $1$-CTC, $2$-CTC (vertical), $2$-CTC (horizontal), $3$-CTC and $4$-CTC respectively}
	\label{race_start}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.40]{img/1CTCfinal}
	\includegraphics[scale=0.40]{img/2CTCv-final}
	\includegraphics[scale=0.40]{img/2CTChorzfinal}
	\includegraphics[scale=0.40]{img/3CTC-final}
	\includegraphics[scale=0.40]{img/4CTC-final}
	\caption{Heatmap showing the final positions of $k$-CTC races. $1$-CTCs (Top left), $2$-CTC-horizontal (Bottom left), $2$-CTC-vertical (Top right), $3$-CTCs (Bottom right) and $4$-CTCs (Bottom). The average distances travelled of the leading edge are: 34.2, 35.1, 30.0, 30.6 and 30.2 respectively. }
	\label{race_end}
\end{figure}


\begin{figure}[h]
	\centering
	\includegraphics[scale=0.40]{img/1CTC-dead}
	\includegraphics[scale=0.40]{img/1CTC-join}
	\caption{Some results of a $1$-CTC race: (Left) A cell died while moving through the ECM, (Right) Two $1$-CTCs to join to make a $2$-CTC. ($8000MCS$)}
	\label{single_results}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.40]{img/2CTC-split}
	\includegraphics[scale=0.40]{img/2CTC-join}
	\caption{Some results of a $2$-CTC (vertical) race: (Left) A $2$-CTC splits into two $1$-CTCs, (Right) Observation of simultaneous splitting and joining events. ($8000MCS$)}
	\label{2CTC-horz}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.40]{img/2CTCh-dead}
	\includegraphics[scale=0.40]{img/2CTCh-split}
	\caption{Some results of a $2$-CTC (horizontal) race: (Left) Complete death of a $2$-CTC, (Right) Splitting of a $2$-CTC. ($8000MCS$)}
	\label{2CTC-vert}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.40]{img/3CTC-join}
	\includegraphics[scale=0.40]{img/3CTC-split}
	\caption{Some results of a $3$-CTC race: (Left) Joining of two $3$-CTCs, (Right) Splitting of a $3$-CTC. ($8000MCS$)}
	\label{3CTC}
\end{figure}

\newpage

\bibliographystyle{abbrv}
\bibliography{396}

\end{document}